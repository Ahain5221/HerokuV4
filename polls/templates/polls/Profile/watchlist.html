{% extends "base_generic.html" %}
{% load static %}

{% block content %}
    <h1 style="padding-bottom: 1em"> {{ profile.user }}'s watchlist</h1>

    <div class="row" style="padding-bottom: 5px">
        <div class="col-sm-1">
            {% if type_of_show == 'all' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user 'all' status%}'"><button class="btn btn-success btn-sm">All</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user 'all' status%}'"><button class="btn btn-dark btn-sm">All</button></a>
            {% endif %}
        </div>

        <div class="col-sm-1">
            {% if type_of_show == 'movies' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user 'movies' status%}'"><button class="btn btn-success btn-sm">Movies</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user 'movies' status%}'"><button class="btn btn-dark btn-sm">Movies</button></a>
            {% endif %}
        </div>

        <div class="col-sm-1">
            {% if type_of_show == 'series' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user 'series' status%}'"><button class="btn btn-success btn-sm">Series</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user 'series' status%}'"><button class="btn btn-dark btn-sm">Series</button></a>
            {% endif %}
        </div>
    </div>

    <div class="row" style="padding-bottom: 15px">
        <div class="col-sm-1">
            {% if status == 'all' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'all'%}'"><button class="btn btn-success btn-sm">All</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'all'%}'"><button class="btn btn-dark btn-sm">All</button></a>
            {% endif %}
        </div>

        <div class="col-sm-1" style="margin-right: 1em">
            {% if status == 'watched' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'watched'%}'"><button class="btn btn-success btn-sm">Watched</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'watched'%}'"><button class="btn btn-dark btn-sm">Watched</button></a>
            {% endif %}
        </div>

        <div class="col-sm-1" style="margin-right: 1.5em">
            {% if status == 'watching' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'watching'%}'"><button class="btn btn-success btn-sm">Watching</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'watching'%}'"><button class="btn btn-dark btn-sm">Watching</button></a>
            {% endif %}
        </div>

        <div class="col-sm-1" style="margin-right: 1em">
            {% if status == 'dropped' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'dropped'%}'"><button class="btn btn-success btn-sm">Dropped</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'dropped'%}'"><button class="btn btn-dark btn-sm">Dropped</button></a>
            {% endif %}
        </div>

        <div class="col-sm-3">
            {% if status == 'want to watch' %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'want to watch'%}'"><button class="btn btn-success btn-sm">Want to watch</button></a>
            {% else %}
                <a onclick="location.href='{% url 'profile-watchlist' profile.user type_of_show 'want to watch'%}'"><button class="btn btn-dark btn-sm">Want to watch</button></a>
            {% endif %}
        </div>
    </div>

    <table class="border-1 bg-dark">
    <tr class="border-1 bg-dark">
        <th class="text-white">Title</th>
        <th class="text-white">Score</th>
        <th class="text-white">Review</th>
        <th class="text-white">Type</th>
        <th class="text-white">Progress</th>
        <th class="text-white">Action</th>
    </tr>


    {% for movie_watchlist, review, in_other_user_watchlist in reviews_and_movies %}
        <tr class="white-list">
        <th> <a href="{{ movie_watchlist.movie.get_absolute_url }}"><strong>{{ movie_watchlist.movie }}</strong></a></th>
        {% if review %}
            <th>{{ review.rate }}</th>
            <th>
                <a href="{% url 'movie-review-detail' pk=review.pk%}">
                    <button class="btn btn-success btn-sm">Display</button>
                </a>
            </th>
        {% else %}
            <th>None</th>
            {% if user == profile.user %}
                {% if movie_watchlist.movie_status == 'want to watch' %}
                    <th>Prohibited</th>
                {% else %}
                    <th>
                        <a href="{% url 'create-movie-review' movie_pk=movie_watchlist.movie.pk%}">
                            <button class="btn btn-success btn-sm">Write</button>
                        </a>
                    </th>
                {% endif %}
            {% else %}
                <th>NO REVIEW</th>
            {% endif %}
        {% endif %}

        <th>{{ movie_watchlist.movie.type_of_show }}</th>

        <th> {{ movie_watchlist.movie_status }}</th>


        {% if user.is_authenticated %}
            {% if user == profile.user %}
                <th>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal{{ movie_watchlist.movie.pk }}">Edit</button>
                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal{{ movie_watchlist.movie.pk  }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content bg-dark">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Edit</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <a href="{% url 'remove-movie-from-watchlist' movie_watchlist.movie.pk profile.user_id %}">
                                        <button class="btn btn-danger btn-sm" style="margin-right: 10em">Delete</button>
                                    </a>
                                    {% if movie_watchlist.movie_status == 'want to watch' %}
                                        <a href="{% url 'movie-watched' movie_watchlist.movie.pk profile.pk %}">
                                            <button class="btn btn-success btn-sm">add to watched</button>
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </th>
            {% else %}
                {% if not in_other_user_watchlist %}
                    <th>
                        <a href="{% url 'add-movie-to-watchlist' movie_watchlist.movie.pk user.pk 'want to watch' %}">
                            <button class="btn btn-success btn-sm">Add to my watchlist</button>
                        </a>
                    </th>

                {% else %}
                    <th>
                        <a href="{% url 'remove-movie-from-watchlist' movie_watchlist.movie.pk user.pk %}">
                            <button class="btn btn-danger btn-sm">Remove from my watchlist</button>
                        </a>
                    </th>
                {% endif %}

            {% endif %}
        {% else %}
            <th>NONE</th>
        {% endif %}
        </tr>
    {% endfor %}

    {% for series_watchlist, review, in_other_user_watchlist in reviews_and_series %}
        <tr class="white-list">
            <th><a href="{{ series_watchlist.series.get_absolute_url }}"><strong>{{ series_watchlist.series }}</strong></a></th>
            {% if review %}
                <th>{{ review.rate }}</th>
                <th>
                    <a href="{% url 'series-review-detail' pk=review.pk%}">
                        <button class="btn btn-success btn-sm">Display</button>
                    </a>
                </th>
            {% else %}
                <th>None</th>
                {% if user == profile.user %}
                    {% if series_watchlist.series_status == 'want to watch' %}
                        <th>Prohibited</th>
                    {% else %}
                        <th>
                            <a href="{% url 'create-series-review' series_pk=series_watchlist.series.pk%}">
                                <button class="btn btn-success btn-sm">Write</button>
                            </a>
                        </th>
                    {% endif %}
                {% else %}
                    <th>NO REVIEW</th>
                {% endif %}
            {% endif %}

            <th>{{ series_watchlist.series.type_of_show }}</th>

            <th>
                {{ series_watchlist.series_status }}
                {% if series_watchlist.progress and series_watchlist.progress != 'None' %}
                    ({{ series_watchlist.progress }})
                {% endif %}
            </th>

            {% if user.is_authenticated %}
                {% if user == profile.user %}
                    <th>
                        <a href="{% url 'series-watchlist-update' series_watchlist.pk %}">
                            <button class="btn btn-primary">Edit</button>
                        </a>
                    </th>
                {% else %}
                    {% if not in_other_user_watchlist %}
                    <th>
                        <a href="{% url 'add-series-to-watchlist' series_watchlist.series.pk user.pk 'want to watch' %}">
                            <button class="btn btn-success btn-sm">Add to my watchlist</button>
                        </a>
                    </th>
                        {% else %}
                            <th>
                        <a href="{% url 'remove-series-from-watchlist' series_watchlist.series.pk user.pk %}">
                            <button class="btn btn-success btn-sm">Remove from my watchlist</button>
                        </a>
                    </th>
                        {% endif %}
                {% endif %}
            {% else %}
                <th>NONE</th>
            {% endif %}
        </tr>
    {% endfor %}

    </table>

{% endblock %}